package com.aimir.fep.meter;

import java.util.Date;
import java.util.Iterator;
import java.util.Map;

import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;
import org.junit.Ignore;
import org.junit.Test;

import com.aimir.fep.meter.parser.Kamstrup;
import com.aimir.fep.meter.parser.Kamstrup162;
import com.aimir.fep.meter.parser.KamstrupOmniPower;
import com.aimir.fep.meter.parser.KamstrupV2;
import com.aimir.fep.util.Hex;
import com.aimir.util.DateTimeUtil;

public class KamstrupMetaTest {
    private static Log log = LogFactory.getLog(KamstrupMetaTest.class);

    @Ignore
    public void test() {
        String meta = "0F403F10003A0004000000000031E30D36403F10041E21020000E4041F210200000004202102000000043422044200000000043522044200000000043622044200000000B67F0D3F403F1004193508000000000000000000040916044300000000041A3508000000000000000000040C16044300000000041B35080000000000000000005E050D34403F1003EB3004000001D7FB03EA2F04000002768A03EC2E04000000015804173508008201120E101B080C04150001000093C80D30403F1003F2330A0000000000000000E62100003333040000E6210000343304000000000000353304000000000048420D74403FA00105000104173508008005000000010A0A000102044100000000001302044100000000001702044100000000001F020441000000000002820300000001080C000000000000000000000000000000000003820500000001060C000000000000000000000000000000000003000310F5FA0D52403FA00103000104193508000000000000000000002716044300000000002B1604430000000000020000000000000000000000000000000000030000000000000000000000000000000000030003109C680D";
        Kamstrup kams = new Kamstrup();
        try {
            kams.parse(Hex.encode(meta));
        } catch (Exception e) {
            // TODO Auto-generated catch block
            e.printStackTrace();
        }
    }

    @Ignore
    public void test5133() throws Exception {
        byte[] b = Hex.encode("1C020000DD070B0B0B1338E20600000400640000000F403F1003E933040000E620FA391A0D3C403F10000D0204440002B0780001020442000006E20013020442000006E2001702044200000000001B02044200000000001F02044200000000C3BF0D0F403F10003A0004000000013FC56E0D36403F10041E21020000E2041F210200000004202102000000043422044300000000043522044300000000043622044300000000B4EC0D3F403F1004193508000000000000000000040916044300000000041A3508000000000000000000040C16044300000000041B35080000000000000000005E050D34403F1003EB3004000002002703EA2F04000001B53303EC2E0400000012160417350800820117130B0B0B0D04150001000040640D30403F1003F2330A0000000000000000E620FA003333040000E620FA003433040000000000003533040000000000B8990D40403FA20705000504173508008002000000010C0B0001020442000006E20013020442000006E2001702044200000000001F02044200000000000500051068920D2E403FA20703000504193508008003000F17120B0B0027160443000000DE002B160443000004D2000500051097FD0D09403FAA0F0F81566C0DF6403FA206054832041735080002010000000B0B0D0001020442000006E200020204420000000000030E04420000000300040E0442000003A448330201000F000B0B0D000006E20000000000000003000003A448340201001E000B0B0D000006E20000000000000003000003A448350201002D000B0B0D000006E20000000000000003000003A4483602010000010B0B0D000006E20000000000000003000003A448370201000F010B0B0D000006E20000000000000003000003A448380201001E010B0B0D000006E20000000000000003000003A448390201002D010B0B0D000006E20000000000000003000003A44839485F0040C20DF6403FA20605483A041735080002010000020B0B0D0001020442000006E200020204420000000000030E04420000000300040E0442000003A4483B0201000F020B0B0D000006E20000000000000003000003A4483C0201001E020B0B0D000006E20000000000000003000003A4483D0201002D020B0B0D000006E20000000000000003000003A4483E02010000030B0B0D000006E20000000000000003000003A4483F0201000F030B0B0D000006E20000000000000003000003A448400201001E030B0B0D000006E20000000000000003000003A448410201002D030B0B0D000006E20000000000000003000003A44841485F0064A10DF6403FA206054842041735080002010000040B0B0D0001020442000006E200020204420000000000030E04420000000300040E0442000003A448430201000F040B0B0D000006E20000000000000003000003A448440201001E040B0B0D000006E20000000000000003000003A448450201002D040B0B0D000006E20000000000000003000003A4484602010000050B0B0D000006E20000000000000003000003A448470201000F050B0B0D000006E20000000000000003000003A448480201001E050B0B0D000006E20000000000000003000003A448490201002D050B0B0D000006E20000000000000003000003A44849485F00D9770DF6403FA20605484A041735080002010000060B0B0D0001020442000006E200020204420000000000030E04420000000300040E0442000003A4484B0201000F060B0B0D000006E20000000000000003000003A4484C0201001E060B0B0D000006E20000000000000003000003A4484D0201002D060B0B0D000006E20000000000000003000003A4484E02010000070B0B0D000006E20000000000000003000003A4484F0201000F070B0B0D000006E20000000000000003000003A448500201001E070B0B0D000006E20000000000000003000003A448510201002D070B0B0D000006E20000000000000003000003A44851485F002A9C0DF6403FA206054852041735080002010000080B0B0D0001020442000006E200020204420000000000030E04420000000300040E0442000003A448530201000F080B0B0D000006E20000000000000003000003A448540201001E080B0B0D000006E20000000000000003000003A448550201002D080B0B0D000006E20000000000000003000003A4485602010000090B0B0D000006E20000000000000003000003A448570201000F090B0B0D000006E20000000000000003000003A448580201001E090B0B0D000006E20000000000000003000003A448590201002D090B0B0D000006E20000000000000003000003A44859485F0048240DC2403FA20605485A0417350800020100000A0B0B0D0001020442000006E200020204420000000000030E04420000000300040E0442000003A4485B0201000F0A0B0B0D000006E20000000000000003000003A4485C0201001E0A0B0B0D000006E20000000000000003000003A4485D0201002D0A0B0B0D000006E20000000000000003000003A4485E020100000B0B0B0D000006E20000000000000003000003A4485F0201000F0B0B0B0D000006E20000000000000003000003A4485F485F0089FA0D");
        
        Kamstrup162 k162 = new Kamstrup162("18011996");
        k162.parse(b);
        k162.setMeteringTime(DateTimeUtil.getDateString(new Date()));
        
        Map map = k162.getData();
        Object key = null;
        for (Iterator i = map.keySet().iterator(); i.hasNext(); ) {
            key = i.next();
            log.info(key + "=" + map.get(key));
        }
    }
    
    @Ignore
    public void testv2() throws Exception {
        byte[] b = Hex.encode("040F3F08000204420204420E04420E04426329000E040F3F08000204420204420E04420E044263290101F4000046A2FFFFFFFFFFFFFFFFFF00000D5C01000000FF00000001000000000000000000000000000000040F3F08000204420204420E04420E044263290101F4000046A2FFFFFFFFFFFFFFFFFF00000D5C01000000FF00000001000000000000000000000000000000040F3F08000204420204420E04420E044263290101F4000046A2FFFFFFFFFFFFFFFFFF00000D5C01000000FF00000001000000000000000000000000000000040F3F08000204420204420E04420E044263290101F4000046A2FFFFFFFFFFFFFFFFFF00000D5C01000000FF00000001000000000000000000000000000000040F3F08000204420204420E04420E044263290101F4000046A2FFFFFFFFFFFFFFFFFF00000D5C01000000FF00000001000000000000000000000000000000040F3F08000204420204420E04420E0442632901010F403F1003E9330400010A9CE072E50D2A403F1000010204420004214400020204420000000000030E04420000000A00040E0442000059BAB84D0D36403F10041E21020000E2041F2102000000042021020000000434220442000002C204352204420000000004362204420000000094130D2E403F1003EB300400000223B403EA2F04000001FD8A03EC2E0400000017BF041735080002032A040D0C020E161D0D");
        
        KamstrupV2 k162 = new KamstrupV2("18011996");
        k162.parse(b);
        k162.setMeteringTime(DateTimeUtil.getDateString(new Date()));
        
        Map map = k162.getData();
        Object key = null;
        for (Iterator i = map.keySet().iterator(); i.hasNext(); ) {
            key = i.next();
            log.info(key + "=" + map.get(key));
        }
    }
    
    @Test
    public void test_omnipower() throws Exception {
        byte[] b = Hex.encode("020F4805000204420204420E04420E0442000009EA0019021D0002E0000048D80000000000001558000001B7021D0002E0000048D80000000000001558000001B7021D0002E0000048D80000000000001558000001B7021D0002E0000048D80000000000001558000001B7021D0002E0000048D80000000000001558000001B7021D0002E0000048D80000000000001558000001B7021D0002E0000048D80000000000001558000001B7021D0002E0000048D80000000000001558000001B7021D0002E0000048D80000000000001558000001B7021D0002E0000048D80000000000001558000001B7021D0002E0000048D80000000000001558000001B7021D0002E0000048D80000000000001558000001B7021D0002E0000048D80000000000001558000001B7021D0002E0000048D80000000000001558000001B7021D0002E0000048D80000000000001558000001B7021D0002E0000048D80000000000001558000001B7021D0002E0000048D80000000000001558000001B7021D0002E0000048D80000000000001558000001B7021D0002E0000048D80000000000001558000001B7021D0002E0000048D80000000000001558000001B7021D0002E0000048D80000000000001558000001B7021D0002E0000048D80000000000001558000001B7021D0002E0000048D80000000000001558000001B7021D0002E0000048D80000000000001558000001B7021D0002E0000048D80000000000001558000001B70A403F015A0011017D2D0D30403F1003F2330A0000000000000001230FB7003333040001230FB7003433040000000000003533040000000000B9620D0F403F1003E933040001230FB70D180D13403FB802010000000000000000020002ACF00D13403FB802010000000000000000020002ACF00D0C403F1000C73A01001E7C840D5D403FB8020605000009B40417480500021CFE87300001020442000048D800020204420000000000030E04420000155800040E0442000001B704170000000708000000000000000000000000000000000000000000000009EA0000593B0D5D403FB8020605000009BC0417480500021CFEBF700001020442000048D800020204420000000000030E04420000155800040E0442000001B704170000000708000000000000000000000000000000000000000000000009EA0000ED280D5D403FB8020605000009C40417480500021CFEF7B00001020442000048D800020204420000000000030E04420000155800040E0442000001B704170000000708000000000000000000000000000000000000000000000009EA0000D22B0D43403FB8020605000009CC0417480500021CFF2FF00001020442000048D800020204420000000000030E04420000155800040E0442000001B7FFFF000009EA000041C60D");
        
        KamstrupOmniPower omni = new KamstrupOmniPower("19321919");
        omni.parse(b);
        omni.setMeteringTime(DateTimeUtil.getDateString(new Date()));
        
        Map map = omni.getData();
        Object key = null;
        for (Iterator i = map.keySet().iterator(); i.hasNext(); ) {
            key = i.next();
            log.info(key + "=" + map.get(key));
        }
    }
}
