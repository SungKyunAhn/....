package com.aimir.fep.protocol.fmp.client;

import org.apache.commons.beanutils.BeanUtils;
import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;
import org.junit.Ignore;
import org.junit.Test;

import com.aimir.fep.meter.data.BillingData;
import com.aimir.fep.meter.entry.IMeasurementData;
import com.aimir.fep.meter.parser.DLMS;
import com.aimir.fep.meter.parser.ElsterA1140;
import com.aimir.fep.meter.parser.elsterA1140Table.A1140_BILLING_DATA;
import com.aimir.fep.meter.saver.ElsterA1140MDSaver;
import com.aimir.fep.util.Hex;
import com.aimir.model.mvm.RealTimeBillingEM;

public class A1140MeterDataTest {
    private static Log log = LogFactory.getLog(A1140MeterDataTest.class);
    
    @Test
    public void test_dlms() {
        try {
            StringBuffer buf = new StringBuffer();
            buf.append("4D440021021301363535303230303038353336363839000000000007DE090C0C1F2C1F63004D540085456C737465722D41313134303838353234373830000000000000000015300292890014000076980000335400000000000043440000236400000D98FFFFFFC40000160800007BC0000034F80000003C000046C800000247000003D4000002FD000001F4094C0008095803C103CAFFFF03B70000008F00FF0000000000AD0000012C00000005424401C900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0800000000000000060000000000000000FF0000000000000000FF0000000000000000FFB3068D52060800000000000030790954060400000000000000000000FF0000000000000000000000FF0000000000000000000000FF0000000000000000000000FF0000000000000000000000FF0000000000000000000000FF0000000000000000000000FF0000000000000000000000FF0000000000000000000000FF0000000000000000000000FF000000000000008130790954434201742002140306000000000000000000000080801732010000000000000000000000000000000000000000000000000000009450741806000000000000000000000040936783020000000000000000000000803774190300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000800000000000000060000000000000000FF0000000000000000FF0000000000000000FFE8B111540660914046000000D8A31154062007664500000038F81154066091234500000000000000FF0000000000000000000000FF0000000000000000000000FF0000000000000000000000FF0000000000000000000000FF0000000000000000000000FF0000000000000000000000FF0000000000000000000000FF0000000000000000000000FF000000000000004C440214E4B06D1154074009E5B06D1154E30042250203123443000000122353E30042385163180343000000197193E30042440943203603000000229653E30042425263192123000000225463E30042431413196813000000226203E30040404883178223000000218313E30040445373203733000000234593E30040456613206693000000242383E30040419283188243000000222743E30040464093215643000000242073E30040367793179913000000182543E30040350113162863000000179523E30040382053171643000000201643E30040387993172133000000207503E30040322533141833000000171053E30040416323186973000000222353E30040401013179053000000213973E30040376103170183000000198533E30040440753202363000000231633E30040452393211473000000234523E30040295413149673000000139423E30040340923164363000000168963E30040272683114463000000144743E30040266843130153000000126533E30040316253131223000000175933E30040293393122233000000160873E30040277183116983000000150033E30040308793141623000000158063E30040312353143623000000157403E480371254074009E30040336843157593000000168153E30040308563167233000000131683E30040331183163573000000155473E30040353193152553000000182443E30040332103147133000000165893FF454C003B00000000000000000000000000000500B96D11549B7C09543979095402060600000000000000000000000000000400307D0954C1068D523B058D52");
            ElsterA1140 parser = new ElsterA1140();
            parser.parse(Hex.encode(buf.toString()));
            //BillingData pb = parser.getBillingData();            
            BillingData cb  = parser.getCurrentBillingData();
            
            
            //Double meteringValue = parser.getMeteringValue();
            
            //parser.get
            //System.out.println(meteringValue);
            System.out.println("CB KVAH1="+cb.getkVah());
            //System.out.println("PB KVAH1="+pb.getKVah());
            //buf = new StringBuffer();
            
            //buf.append("00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0800000000000000060000000000000000FF0000000000000000FF0000000000000000FFB3068D52060800000000000030790954060400000000000000000000FF0000000000000000000000FF0000000000000000000000FF0000000000000000000000FF0000000000000000000000FF0000000000000000000000FF0000000000000000000000FF0000000000000000000000FF0000000000000000000000FF0000000000000000000000FF000000000000008130790954");
            
            //A1140_BILLING_DATA billParser = new A1140_BILLING_DATA(Hex.encode(buf.toString()));
            //BillingData pb = billParser.getBillingData();
            //System.out.println(pb.getKvah());
            RealTimeBillingEM bill = new RealTimeBillingEM();
            try {
                BeanUtils.copyProperties(bill, cb);
            } catch (Exception e) {
                log.warn(e);
            }
            System.out.println("CB ActiveEnergyRateTotal="+bill.getActiveEnergyRateTotal());
            System.out.println("CB KVAH2="+bill.getkVah());
        }
        catch (Exception e) {
            log.error(e);
        }
    }

}
